<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>world share login mod,by big,2016/12/9</title>
</head>
<body>
    <pe:mcml>
        <script type="text/npl" refresh="false">
            <![CDATA[
	            InternetLoadWorld = commonlib.gettable("MyCompany.Aries.Creator.Game.Login.InternetLoadWorld");
                loginMain         = commonlib.gettable("Mod.WorldShare.login.loginMain");

                InternetLoadWorld.OnInit();
                loginMain.OnInit();
                loginMain.setLoginPage();
                loginMain.getRememberPassword();
                loginMain.setSite();
                loginMain.autoLoginAction();
                loginMain.RefreshCurrentServerList();
            ]]>
        </script>
        <style type="text/mcss">
            {
                user_area = {
                    float  = "left",
                    width  = 345,
                    height = 441,
                    ["padding-left"]  = 25,
                    ["padding-right"] = 30,
                },
                user_area_world_type = {
                    ["margin-top"] = 20,
                    height = 40,
                },
                user_area_world_type_selected = {
                    height = 30,
                    spacing = 20,
                    background = "textures/worldshare_32bits.png;194 128 120 40:8 8 8 8",
                    color = "#FFFFFF",
                    ["margin-right"] = 15,
                },
                user_area_world_type_unselect = {
                    height = 30,
                    spacing = 20,
                    background = "textures/worldshare_32bits.png;324 128 120 40:8 8 8 8",
                    color = "#FFFFFF",
                    ["margin-right"] = 15,
                },
                user_login = {
                    ["base-font-size"]   = 16,
                    ["font-size"]        = 16,
                    ["margin-top"]       = 10,
                    color                = "#ffffff",
                    ["background-color"] = "#454340",
                    ["padding-right"]    = 20,
                    ["padding-left"]     = 20,
                    ["padding-top"]      = 20,
                    height               = 295,
                },
                text_field = {
                    background = "textures/worldshare_32bits.png;20 78 250 40:8 8 8 8",
                    border = "none",
                },
                login_button = {
                    ["margin-left"] = 55,
                    width           = 150,
                    height          = 33,
                    textcolor = "#ffffff",
                    color = "#ffffff",
                    background      = "textures/worldshare_32bits.png;250 20 220 48:8 8 8 8",
                },
                logged_common_button = {
                    width = 130,
                    height = 31,
                    ["margin-left"] = 60,
                    ["margin-bottom"] = 20,
                    textcolor = "#ffffff",
                    color = "#ffffff",
                    background = "textures/worldshare_32bits.png;20 20 220 48:8 8 8 8",
                },
                middle_line = {
                    float  = "left",
                    width  = 2,
                    height = 441,
                    ["margin-left"] = 0,
                    ["margin-top"]  = 0,
                    ["background-color"] = "#b7b2b2"
                },
                world_area = {
                    float = "left",
                    width  = 345,
                    height = 441,
                    ["padding-top"] = 20,
                    ["padding-left"] = 30,
                    ["padding-right"] = 20,
                },
                add_server_text_field = {
                    textcolor = "#ffffff",
                    float = "left",
                    width = 237,
                    height = 30,
                    background = "Texture/Aries/Creator/Theme/GameCommonIcon_32bits.png;263 346 36 36:15 15 15 15",
                },
                add_server_button = {
                    ["margin-left"] = 8,
                    height = 30,
                    ["min-width"] = 50,
                },
                share_selected_item = {
                    ["margin-left"] = 0,
                    ["margin-bottom"] = 10,
                    ["padding-left"] = 5,
                    ["padding-top"] = 5,
                    width  = 295,
                    height = 80,
                    background = "textures/worldshare_32bits.png;20 188 100 100:8 8 8 8"
                },
                share_unselect_item = {
                    ["margin-bottom"] = 20,
                    ["padding-left"] = 5,
                    ["padding-top"] = 5,
                    width  = 295,
                    height = 65,
                    ["background-color"] = "#454340",
                },
                share_world_name = {
                    ["text-singleline"] = "true",
                    width = 30,
                    float = "left",
                    ["base-font-size"] = 16,
                    ["font-size"] = 16,
                    ["margin-top"] = 2,
                    ["text-align"] = "left",
                    color = "#ffffff",
                },
                share_world_infor = {
                    ["text-singleline"] = "true",
                    float = "left",
                    ["margin-left"] = 8,
                    height = 18,
                    ["font-size"] = 12,
                    color = "#9e9e9e",
                },
                share_button = {
                    width = 32,
                    height = 32,
                    ["margin-right"] = 6,
                },
                common_button = {
                    height = 30,
                    spacing = 20,
                    ["font-weight"] = "bold",
                    ["font-size"]   = 14,
                },
            }
        </style>
        <div style="width:860px;height:470px;">
            <div style="float:left;margin-top:0px;width:160px;height:470px;" class="mc_panel">
                <pe:if condition='<%= System.options.mc%>'>
                    <div style="position:relative;margin-left:0px;margin-top:0px;">
                        <div style="margin-left:0px;margin-top:0px;">
                            <pe:if condition='<%= System.User.isOnline%>'>
                                <pe:if condition='<%= loginMain.current_type%>'>
                                    <div style="margin-top: 20px; text-align: center; color: #ffffff;">
                                        <%= GetCurrentServerPageNickName() %>
                                    </div>
                                    <div style="margin-left:45px;margin-top:10px;">
                                        <input type="button" value="修改名称" onclick="loginMain.ChangeName()" style="width: 70px; height: 22px; color: #ffffff; " class="mc_light_grey_button_with_fillet" />
                                    </div>
                                </pe:if>
                                <pe:if condition='<%= loginMain.IsChangingName()%>'>
                                    <div style="margin-left:15px;margin-top:20px;">
                                        <input type="text" name="nickname" autofocus="true" value='<%= loginMain.GetUserNickName() %>' rows="1" style="margin-top:0px;margin-left:0px;width:130px;height:22px;" class="mc_text" />
                                    </div>
                                    <div style="margin-left: 0px; margin-top: 10px;">
                                        <input type="button" value="确定" onclick="loginMain.SaveName()" style="float: left; margin-left: 15px; width: 60px; height: 22px; color: #ffffff; " class="mc_light_grey_button_with_fillet" />
                                        <input type="button" value="取消" onclick="loginMain.CancelChangeName()" style="float: left; margin-left: 10px; width: 60px; height: 22px; color: #ffffff; " class="mc_light_grey_button_with_fillet" />
                                    </div>
                                </pe:if>
                            </pe:if>
                        </div>
                    </div>
                    <div style="position:relative;margin-left:-48px;margin-top:90px;width:256px;height:226px;">
                        <div>
                            <pe:mc_player name="MyPlayer" miniscenegraphname="AvatarMyselfTabCharacter" style="width:256px;height:256px;" isinteractive="false" />
                        </div>
                    </div>
                    <div style="position:relative;margin-left:0px;margin-top:340px;height:256px;">
                        <div style="margin-left:0px;margin-top:0px;height:50px;">
                            <pe:if condition='<%= System.User.isOnline%>'>
                            </pe:if>
                            <pe:if condition='<%= not System.User.isOnline%>'>
                            </pe:if>
                        </div>
                    </div>
                </pe:if>
            </div>
            <aries:window mode="thin" width="700" height="470" style="float:left;" title='<%=L"服务器列表" %>' onclose="loginMain.ClosePage()"> 
                <div style="width:700px;height:470px;">
                    <!--categories-->
                    <!-- 登陆界面 -->
                    <div class="user_area">
                        <div class="user_area_world_type">
                            <pe:repeat DataSource="<%=loginMain.GetWorldType()%>">
                                <pe:repeatitem style="float:left;">
                                    <pe:if condition='<%=InternetLoadWorld.type_index == Eval("index") %>'>
                                        <input type="button" value='<%=Eval("text")%>' name='<%=Eval("index")%>' onclick="loginMain: OnChangeType()" class="user_area_world_type_selected" />
                                    </pe:if>
                                    <pe:if condition='<%=InternetLoadWorld.type_index ~= Eval("index") %>'>
                                        <input type="button" value='<%=Eval("text")%>' name='<%=Eval("index")%>' onclick="loginMain: OnChangeType()" class="user_area_world_type_unselect" />
                                    </pe:if>
                                </pe:repeatitem>
                            </pe:repeat>
                        </div>
                        <!--未登陆-->
                        <pe:if condition="<%=loginMain.login_type == 1 %>">
                            <div name="loginMain" class="user_login">
                                <div style="margin-bottom:12px;">
                                    服务器：
                                    <select name="loginServer" onclick="loginMain.setSite()" style="height: 30px;width: 185px;" class="text_field">
                                        <option selected="selected" value="keepwork" name="keepwork">使用KeepWork登录</option>
                                        <option value="keepworkDev"  name="keepworkDev">使用KeepWorkDev登录</option>
                                        <option value="keepworkTest" name="keepworkTest">使用KeepWorkTest登录</option>
                                        <option value="local" name="local">使用本地服务登录</option>
                                    </select>
                                </div>
                                <div style="margin-bottom:12px;margin-left:15px;">
                                    账号：<input type="text" EmptyText="账户名/邮箱/手机号" class="bbs_text text_field" style="height: 30px;" name="account"/>
                                </div>
                                <div style="margin-bottom:12px;margin-left:15px">
                                    密码：<input type="text" PasswordChar="*" class="bbs_text text_field" style="height: 30px;" name="password"/>
                                </div>
                                <div>
                                    <input type="checkbox" checked="true" style="float:left;margin-left:60px;margin-top:3px;" name="autoLogin" /><div style="float:left" for="autoLogin">自动登录</div>
                                    <input type="checkbox" style="float:left;margin-left:10px;margin-top:3px;" name="rememberPassword" /><div style="float:left" for="rememberPassword">记住密码?</div>
                                </div>
                                <div style="margin-top:30px;margin-bottom:15px;">
                                    <input type="button" DefaultButton="true" class="login_button" onclick="loginMain.LoginActionMain()" value="登   录"/>
                                </div>
                                <div style="text-align:left;margin-left:55px;">
                                    <span style="color:#ffffff;">还没有帐号？</span>
                                    <a name="register" style="background:url(textures/worldshare_32bits.png#399 76 64 30:0 0 0 0);height:30px;width:150px;font-size: 14px;color: #fe5927;">点击注册</a>
                                </div>
                            </div>
                        </pe:if>
                        <pe:if condition="<%=loginMain.login_type == 3 %>">
                            <div name="loginsuccess" class="user_login" style="width:290px;">
                                <div style="margin-bottom:25px;">
                                    你已使用<span style="color:#ff6666"><%=loginMain.username%></span>成功登录。
                                </div>
                                <div style="margin-bottom:13px;">
                                    我的作品网站
                                    <input type="button" onclick="loginMain.sharePersonPage()" style="width:20px;height:16px;background:url(textures/worldshare_32bits.png#280 81 25 20:0 0 0 0);margin-top:3px;margin-left:13px;" class="button_highlight" />
                                </div>
                                <div style="height:90px;">
                                    <%=loginMain.personPageUrl %>
                                </div>
                                <div>
                                    <input type="button" name="myWorlds" class="logged_common_button" onclick="loginMain.sharePersonPage()" value="打开作品网站" />
                                </div>
                                <div>
                                    <input type="button" onclick="loginMain.logout()" class="logged_common_button" value="退出登录" />
                                </div>
                            </div>
                        </pe:if>
                        <div style="margin-top:20px">
                            <input type="button" value='<%=L"导入/导出..." %>'  onclick="loginMain.OnImportWorld()" class="common_button mc_light_grey_button_with_fillet" />
                            <input type="button" value='<%=L"刷新" %>' style="margin-left:15px;" onclick="loginMain.RefreshCurrentServerList()" class="common_button mc_light_grey_button_with_fillet" />
                        </div>
                    </div>
                    <!--line-->
                    <div class="middle_line" />
                    <!--worlds-->
                    <div class="world_area">
                        <div style="height: 25px;margin-bottom:25px;">
                            <input type="text" name="content" EmptyText='<%=loginMain.GetDefaultValueForAddress() %>' rows="1" CaretColor="#FFFFFFFF" class="add_server_text_field" />
                            <input type="button" value='<%=L"添加" %>' class="add_server_button mc_light_grey_button_with_fillet" onclick="InternetLoadWorld.OnAddSearchPage"/>
                        </div>
                        <div style="height: 308px;width:315px;">
                            <pe:gridview RememberScrollPos="true" AllowPaging="false" VerticalScrollBarStep="30" DefaultNodeHeight="80" ItemsPerLine="1" name="gw_world_ds" DataSource='<%=InternetLoadWorld.DS_Func_Worlds%>'>
                                <Columns>
                                    <!--选中的项-->
                                    <pe:if condition='<%= Eval("index") == InternetLoadWorld.selected_world_index%>'>
                                        <div name='<%=Eval("index")%>' class="share_selected_item">
                                            <pe:if condition='<%= loginMain.current_type == 1%>'>
                                                <div>
                                                    <pe:if condition='<%= loginMain.login_type == 3 and not loginMain.GetCurWorldInfo("is_zip", Eval("index")) and  loginMain.GetCurWorldInfo("status",Eval("index")) == 3%>'>
                                                        <div style="float:left;width:32px;height:32px;background:url(textures/worldshare_32bits.png#315 81 32 32:0 0 0 0)" tooltip='<%= loginMain.formatStatus(loginMain.GetCurWorldInfo("status",Eval("index")))%>'/>
                                                    </pe:if>
                                                    <pe:if condition='<%= loginMain.login_type == 3 and not loginMain.GetCurWorldInfo("is_zip", Eval("index")) and  loginMain.GetCurWorldInfo("status",Eval("index")) ~= 3%>'>
                                                        <div style="float:left;width:32px;height:32px;background:url(textures/worldshare_32bits.png#357 81 32 32:0 0 0 0)" tooltip='<%= loginMain.formatStatus(loginMain.GetCurWorldInfo("status",Eval("index")))%>'/>
                                                    </pe:if>
                                                    <pe:if condition='<%= loginMain.login_type == 1 or loginMain.GetCurWorldInfo("is_zip", Eval("index"))%>'>
                                                        <div style="float:left;width:9px;height:32px;background:#fff" />
                                                    </pe:if>
                                                    <div class="share_world_name">
                                                        <%= Eval("text") %><%= if_else( Eval("is_zip") == true, L".zip", "")%>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="share_world_infor" style="position:relative;margin-top:2px;">
                                                        <div>
                                                            <pe:if condition='<%= loginMain.login_type == 3%>'>
                                                                <div style="float:left;width:25px;height:20px;background:#fff" />
                                                            </pe:if>
                                                            <span style="float:left;margin-left:0px;">v<%=loginMain.GetCurWorldInfo("revision",Eval("index")) %></span>
                                                            <span style="float:left;margin-left:15px;"><%=loginMain.GetWorldSize(Eval("size")) %></span>
                                                        </div>
                                                        <div>
                                                            <pe:if condition='<%= loginMain.login_type == 3%>'>
                                                                <div style="float:left;width:24px;height:20px;background:#fff" />
                                                            </pe:if>
                                                            <span style="margin-left:0px;"><%=loginMain.formatDatetime(loginMain.GetCurWorldInfo("modifyTime",Eval("index"))) %></span>
                                                        </div>
                                                    </div>
                                                    <div style="position:relative;margin-left:170px;margin-top:3px;">
                                                        <pe:if condition='<%= loginMain.login_type == 1 or loginMain.GetCurWorldInfo("is_zip", Eval("index"))%>'>
                                                            <div class="share_button" style="float:left"/>
                                                        </pe:if>
                                                        <input type="button" class="share_button" style="background:url(textures/worldshare_32bits.png#78 130 48 48)"   onclick='loginMain.deleteWorld()' tooltip="删除" name='<%=Eval("index")%>' /><!-- 删除 -->
                                                        <pe:if condition="<%= loginMain.login_type == 3 and not loginMain.GetCurWorldInfo('is_zip', Eval('index'))%>">
                                                            <input type="button" class="share_button" style="background:url(textures/worldshare_32bits.png#136 130 48 48)" onclick="loginMain.syncNow()" tooltip="同步" name='<%=Eval("index")%>' /><!-- 手动同步 -->
                                                        </pe:if>
                                                        <input type="button" class="share_button" style="background:url(textures/worldshare_32bits.png#20 130 48 48)"    onclick="loginMain.enterWorld()" tooltip="进入" name='<%=Eval("index")%>' /><!-- 进入 -->
                                                    </div>
                                                </div>
                                            </pe:if>
                                            <pe:if condition='<%= loginMain.current_type == 2%>'>
                                                <div>
                                                    <div style="margin-left:5px;">
                                                        <div class="share_world_name">
                                                            <%=Eval("text") %><%=if_else( Eval("is_zip") == true , L".zip", "")%>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div>
                                                    <div class="share_world_infor" style="position:relative;margin-left:5px;margin-top:18px;">
                                                        <span style="margin-left:0px;">v<%=loginMain.GetCurWorldInfo("revision",Eval("index")) %></span>
                                                        <span style="margin-left:10px;"><%=loginMain.GetWorldSize(Eval("size")) %></span>
                                                        <span style="margin-left:10px;"><%=Eval("author") %></span>
                                                    </div>
                                                    <div style="position:relative;margin-left:250px;margin-top:3px;">
                                                        <input type="button" class="share_button" style="background:url(textures/worldshare_32bits.png#20 130 48 48:6 6 6 6)" onclick="loginMain.enterWorld()" name='<%=Eval("index")%>' /><!--进入-->
                                                    </div>
                                                </div>
                                            </pe:if>
                                            <!--<div style="position:relative;margin-left:10px;margin-top:28px;font-size:12px;color:#9e9e9e">
                                                <input type="button" name='<%=Eval("slot_id")%>' value="在线保存" tooltip="上传本地世界到服务器" style="width:68px;height:20px;font-size:12px;" onclick="loginMain.OnSaveToSlot()" class="mc_light_grey_button_with_fillet" />
                                                <input type="button" name='<%=Eval("slot_id")%>' value="下载本地" tooltip="将本地世界和服务器存档同步或从服务器下载世界" style="margin-left:10px;width:68px;height:20px;font-size:12px;" onclick="InternetLoadWorld.OnCopyFormSlot" class="mc_light_grey_button_with_fillet" />
                                            </div>-->
                                        </div>
                                    </pe:if>

                                    <!--未选中的项-->
                                    <pe:if condition='<%= Eval("index") ~= InternetLoadWorld.selected_world_index%>'>
                                        <input type="button" style="position:relative;width:297px;height:70px;background:#000000" name='<%=Eval("index")%>' onclick="loginMain.OnSwitchWorld" />
                                        <div name='<%=Eval("index")%>' class="share_unselect_item">
                                            <pe:if condition='<%= loginMain.current_type == 1%>'>
                                                <div style="position:relative;width:200px;">
                                                    <div>
                                                        <pe:if condition='<%= loginMain.login_type == 3 and not loginMain.GetCurWorldInfo("is_zip", Eval("index")) and  loginMain.GetCurWorldInfo("status",Eval("index")) == 3%>'>
                                                            <div style="float:left;width:32px;height:32px;background:url(textures/worldshare_32bits.png#315 81 32 32:0 0 0 0)" tooltip='<%= loginMain.formatStatus(loginMain.GetCurWorldInfo("status",Eval("index")))%>'/>
                                                        </pe:if>
                                                        <pe:if condition='<%= loginMain.login_type == 3 and not loginMain.GetCurWorldInfo("is_zip", Eval("index")) and  loginMain.GetCurWorldInfo("status",Eval("index")) ~= 3%>'>
                                                            <div style="float:left;width:32px;height:32px;background:url(textures/worldshare_32bits.png#357 81 32 32:0 0 0 0)" tooltip='<%= loginMain.formatStatus(loginMain.GetCurWorldInfo("status",Eval("index")))%>'/>
                                                        </pe:if>
                                                        <pe:if condition='<%= loginMain.login_type == 1 or loginMain.GetCurWorldInfo("is_zip", Eval("index"))%>'>
                                                            <div style="float:left;width:9px;height:32px;background:#fff"/>
                                                        </pe:if>
                                                        <div class="share_world_name">
                                                            <%= Eval("text") %><%= if_else( Eval("is_zip") == true, L".zip", "")%>
                                                        </div>
                                                    </div>
                                                    <div class="share_world_infor" style="padding-top:5px;">
                                                        <pe:if condition='<%= loginMain.login_type == 3%>'>
                                                            <div style="float:left;width:24px;height:10px;background:#fff" />
                                                        </pe:if>
                                                        <span style="float:left;margin-left:0px;"><%=loginMain.formatDatetime(loginMain.GetCurWorldInfo("modifyTime",Eval("index"))) %></span>
                                                        <span style="float:left;margin-left:10px;">v<%=loginMain.GetCurWorldInfo("revision",Eval("index")) %></span>
                                                        <span style="float:left;margin-left:10px;"><%=loginMain.GetWorldSize(Eval("size")) %></span>
                                                    </div>
                                                </div>
                                                <div align="right" style="position:relative;width:30px;height:30px;margin-right:13px;margin-top:20px;">
                                                    <input type="button" class="share_button" style="background:url(textures/worldshare_32bits.png#20 130 48 48:6 6 6 6)" onclick="loginMain.enterWorld()" name='<%=Eval("index")%>' /><!--进入-->
                                                </div>
                                            </pe:if>
                                            <pe:if condition='<%= loginMain.current_type == 2%>'>
                                                <div style="position:relative;width:200px;">
                                                    <div style="margin-left:5px;">
                                                        <div class="share_world_name">
                                                            <%=Eval("text") %><%=if_else(Eval("is_zip")==true, L".zip", "")%>
                                                        </div>
                                                    </div>
                                                    <div class="share_world_infor" style="margin-left:5px;padding-top:5px;">
                                                        <span style="margin-left:0px;">v<%=loginMain.GetCurWorldInfo("revision",Eval("index")) %></span>
                                                        <span style="margin-left:10px;"><%=loginMain.GetWorldSize(Eval("size")) %></span>
                                                        <span style="margin-left:10px;"><%=Eval("author") %></span>
                                                    </div>
                                                </div>
                                            </pe:if>
                                        </div>
                                    </pe:if>
                                </Columns>
                                <EmptyDataTemplate>
                                    <div style="margin:10px;font-weight:bold;color:#ffffff"><%=L"暂无存档，请创建" %></div>
                                    <div>
                                        <input type="button" class="mc_light_grey_button_with_fillet" onclick="InternetLoadWorld.RefreshCurrentServerList" value='<%=L"刷新" %>' style="float:left;margin-left:10px;width:86px;height:22px;font-weight:bold;font-size:14px;" />
                                    </div>
                                </EmptyDataTemplate>
                                <FetchingDataTemplate>
                                    <div style="margin-top:10px;font-weight:bold;color:#ffffff"><%=L"正在搜索, 请稍候 ... " %></div>
                                </FetchingDataTemplate>
                            </pe:gridview>
                        </div>
                        <div style="margin-top:7px;padding-right:15px;">
                            <input type="button" value='<%=L"创建世界" %>' style="float:left" onclick="loginMain.CreateNewWorld()" class="common_button mc_light_grey_button_with_fillet" />
                            <input type="button" value='<%=L"官方论坛" %>' align="right" style="float:right" onclick="loginMain.OpenBBS()" class="common_button mc_light_grey_button_with_fillet" />
                        </div>
                    </div>
                </div>
            </aries:window>
        </div>
    </pe:mcml>
</body>
</html>